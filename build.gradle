plugins {
    id 'java'
    id "com.github.davidmc24.gradle.plugin.avro" version "1.7.0"
    id "com.github.node-gradle.node" version "3.5.1"
}

group 'com.lavro'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
    maven {
        url "https://clojars.org/repo/"
    }
    maven {
        url "https://packages.confluent.io/maven"
    }
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.10.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.10.0'
    // https://mvnrepository.com/artifact/org.slf4j/slf4j-api
    implementation 'org.slf4j:slf4j-api:2.0.9'
    // https://mvnrepository.com/artifact/org.slf4j/slf4j-simple
    implementation 'org.slf4j:slf4j-simple:2.0.9'
    implementation "org.apache.avro:avro:1.11.1"
    implementation "com.github.javafaker:javafaker:1.0.2"
    implementation(project(":schemas"))
    implementation(project(":custom-conversions"))
    implementation 'org.apache.kafka:kafka-clients:3.5.1'
    // https://mvnrepository.com/artifact/io.confluent/kafka-avro-serializer
    implementation 'io.confluent:kafka-avro-serializer:5.3.0'


}

test {
    useJUnitPlatform()
}

//task generateProtocol(type: GenerateAvroProtocolTask) {
//    shouldRunAfter "build"
//    source file("src/main/avro")
//    include("**/*.avdl")
//    outputDir = file("build/generated-main-avro-avpr")
//}
//
//task generateSchema(type: GenerateAvroSchemaTask){
//    shouldRunAfter "build"
//    source file("build/generated-main-avro-avpr")
//    include("**/*.avpr")
//    outputDir = file("build/generated-main-avro-avsc")
//}

//task generateSchema(type: GenerateAvroSchemaTask){
//    dependsOn(GenerateAvroProtocolTask)
//    source file("build/generated-main-avro-avpr")
//    include("**/*.avpr")
//    outputDir = file("build/generated-main-avro-avsc")
////    mustRunAfter tasks.withType(GenerateAvroProtocolTask)
//}

//tasks.register("generateSchema2", GenerateAvroSchemaTask) {
//    dependsOn generateProtocol
//    source file("build/generated-avro-main-avpr")
//    include("**/*.avpr")
//    outputDir = file("build/generated-main-avro-avsc")
//}

//avro {
//    enableDecimalLogicalType = false
//    stringType = "CharSequence"
//    conversionsAndTypeFactoriesClasspath.from(configurations.customConversions)
//    logicalTypeFactoryClassNames.put("reversed", "com.lavro.ReversedLogicalTypeFactory")
//    customConversionClassNames.add("com.lavro.ReversedConversion")
//}

//task generateAvrodoc(type: NpxTask) {
//    dependsOn(generateSchema)
//    command = '@mikaello/avrodoc-plus'
//    args = ['-i','build/generated-main-avro-avsc', '-o','index.html']
//    mustRunAfter tasks.withType(GenerateAvroJavaTask)
//}